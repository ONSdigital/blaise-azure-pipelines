---
steps:
  - task: DownloadSecureFile@1
    displayName: Download test questionnaire from Azure DevOps
    name: testQuestionnaire
    inputs:
      secureFile: '$(QuestionnaireName).bpkg'
      retryCount: 3
  - task: PowerShell@2
    displayName: Copy questionnaire to survey directory
    inputs:
      targetType: inline
      script: |
        try {
          Write-Host "ğŸ“¦ Copying test questionnaire to survey directory..."
          
          # Ensure the survey directory exists
          if (-not (Test-Path "c:\survey")) {
            Write-Host "ğŸ“ Creating c:\survey directory..."
            New-Item -Path "c:\survey" -ItemType Directory -Force | Out-Null
          }
          
          # The downloaded file path is in the variable $(testQuestionnaire.secureFilePath)
          Copy-Item -Path "$(testQuestionnaire.secureFilePath)" `
            -Destination "c:\survey\$env:QuestionnaireName.bpkg" `
            -Force
          
          Write-Host "âœ… Test questionnaire package copied successfully!"
        }
        catch {
          Write-Host "ğŸš¨ ERROR during test questionnaire package copy!"
          Write-Error "âŒ Exception details: $_"
          exit 1
        }