---
steps:
  - task: DownloadSecureFile@1
    displayName: Download CMA multi package from Azure DevOps
    name: cmaMultiPackage
    inputs:
      secureFile: '$(ENV_CMA_MULTI_PACKAGE)'
      retryCount: 3

  - task: PowerShell@2
    displayName: Copy CMA package to destination
    inputs:
      targetType: inline
      script: |
        try {
          Write-Host "üì¶ Copying CMA multi package to destination..."
          
          # Ensure the CMA directory exists
          if (-not (Test-Path "C:\CMA")) {
            Write-Host "üìÅ Creating C:\CMA directory..."
            New-Item -Path "C:\CMA" -ItemType Directory -Force | Out-Null
          }
          
          # The downloaded file path is in the variable $(cmaMultiPackage.secureFilePath)
          Copy-Item -Path "$(cmaMultiPackage.secureFilePath)" `
            -Destination "C:\CMA\CMA-MULTI.zip" `
            -Force
          
          Write-Host "‚úÖ CMA multi package copied successfully!"
          Write-Host "üìÅ Destination: C:\CMA\CMA-MULTI.zip"
        }
        catch {
          Write-Host "üö® ERROR during CMA package copy!"
          Write-Error "‚ùå Exception details: $_"
          exit 1
        }